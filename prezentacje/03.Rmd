---
title: "Korelacja i regresja"
author: "Łukasz Wawrowski"
date: ""
output:
  xaringan::moon_reader:
    css: ["default.css", "default-fonts.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false


---

# Rozgrzewka (10 min.)

1. Utwórz nowy projekt w RStudio o nazwie zajęcia `adr20181216`.
2. Utwórz nowy skrypt R i wczytaj pakiety `tidyverse` i `readxl` - możliwe, że trzeba będzie je zainstalować.
3. Ze strony http://www.wawrowski.edu.pl/adr/ pobierz plik `Rossmann.xlsx` i z wykorzystaniem funkcji `read_xlsx()` przypisz ten zbiór do obiektu o nazwie `rossmann`.
4. Stwórz obiekt o nazwie `sklep77` zawierający dane wyłącznie o sklepie nr 77 i dniach, w których był otwarty.

```{r eval=FALSE, include=FALSE}
library(tidyverse)
library(readxl)

rossmann <- read_xlsx("../data/rossmann.xlsx")

sklep77 <- rossmann %>%
  filter(sklep_id==77, czy_otwarty=="Tak")

```


---

# Korelacje

Korelacja [łac.], mat. wzajemne powiązanie, współzależność zjawisk lub obiektów.

- korelacja cech jakościowych - statystyka $\chi^2$

  - płeć na zdanie egzaminu
  - wykształcenie a zajmowane stanowisko

- korelacja cech ciągłych - współczynnik korelacji liniowej Pearsona

  - dochody a wydatki
  - odległość a czas
  - dochody a prawdopodobieństwo ubóstwa

---

# Test $\chi^2$

Ten test jest stosowany w przypadku badania niezależności cech jakościowych. Układ hipotez jest następujący:

- H0: zmienne są niezależne 
- H1: zmienne nie są niezależne

Na podstawie przyjętego poziomu istotności $\alpha$ (zwykle $\alpha=0.05$) i wartości p podejmuje się decyzję o odrzuceniu hipotezy zerowej. Jeśli $\alpha > p$ to są podstawy do odrzucenia hipotezy zerowej.

---

# Współczynnik V-Cramera

Określa siłę zależności pomiędzy dwoma zmiennymi jakościowymi. 

$$V=\sqrt{\frac{\chi^2}{n \cdot min(k-1,r-1)}}$$

gdzie:

- $\chi^2$ - wyznaczona wartość statystyki $\chi^2$,
- $n$ - liczba wszystkich obserwacji,
- $k$ - liczba wariantów pierwszej cechy,
- $r$ - liczba wariantów drugiej cechy.

Przyjmuje wartości od 0 do 1, gdzie 0 oznacza brak zależności. 

---

# Przykład

Czy istnieje zależność pomiędzy promocją danego dnia, a sprzedażą? Zmienną `sprzedaż` przekształcimy ze zmiennej ilościowej na jakościową tworząc dwie kategorie: powyżej i poniżej średniej sprzedaży.

---

# Zadania 1. (5 min.)

Oblicz siłę zależności pomiędzy promocją a sprzedażą wykorzystując współczynnik V-Cramera. Wartość statystyki $\chi^2$ można pobrać w następujący sposób: `chisq.test(tabela)$statistic`.

```{r eval=FALSE, include=FALSE}

sklep77 <- sklep77 %>%
  mutate(sprzedaz_srednia=ifelse(sprzedaz>mean(sprzedaz), "Powyżej średniej", "Poniżej średniej"))

tabela <- table(sklep77$sprzedaz_srednia, sklep77$czy_promocja)

chisq.test(tabela)

chi <- chisq.test(tabela)$statistic

sqrt(chi/nrow(sklep77))

```


---

# Współczynnik korelacji liniowej Pearsona

Pozwala określić siłę oraz kierunek zależności pomiędzy dwoma zmiennymi ilościowymi.

Współczynnik ten jest wielkością unormowaną, przyjmuje wartości z przedziału $r\in<-1;1>$.

Jeśli:

- $r_{xy}=1$ — korelacja dodatnia doskonała,
- $0<r_{xy}<1$ — korelacja dodatnia niedoskonała (słaba/umiarkowana/silna)
- $r_{xy}=0$ — brak zależności,
- $-1<r_{xy}<0$ — korelacja ujemna niedoskonała (słaba/umiarkowana/silna)
- $r_{xy}=-1$ — korelacja ujemna doskonała.

---

# Przykład

Ile wynosi współczynnik korelacji liniowej Pearsona pomiędzy sprzedażą a liczbą klientów?

---

# R jako narzędzie do raportowania

Połączenie języka __R__ i __markdown__ umożliwia tworzenie dynamicznych raportów, które można eksportować do plików:

- html,
- pdf (potrzebny [MiKTeX](https://miktex.org/)),
- docx.

Zajrzyjmy do pliku __02_raport.Rmd__

---

# Markdown - tekst

Większość raportu będzie stanowił zwykły tekst.

.pull-left[
__Kod__
```
To jest zwykły tekst.
_Kursywa_ i __pogrubienie__.
Enter nie wystarczy, żeby przejść  
do nowej linii - trzeba wstawić  
co najmniej __dwie spacje__.
```
]
.pull-right[
__Wynik__   
  
To jest zwykły tekst.  
_Kursywa_ i __pogrubienie__.  
Enter nie wystarczy, żeby przejść  
do nowej linii - trzeba wstawić  
co najmniej __dwie spacje__.
]

---

# Nagłówki

Struktura dokumentu definiowa jest przez nagłówki.

__Kod__
```
# Nagłówek pierwszego stopnia
## Nagłówek drugiego stopnia
### Nagłówek trzeciego stopnia
```

__Wynik__   
   
# Nagłówek pierwszego stopnia
## Nagłówek drugiego stopnia
### Nagłówek trzeciego stopnia

---
# Listy

.pull-left[
__Kod__
```
1. Pozycja 1
2. Pozycja 2
3. Pozycja 3
    - Pozycja 3a
    - Pozycja 3b
```
]
.pull-right[
__Wynik__   
   
1. Pozycja 1
2. Pozycja 2
3. Pozycja 3
    - Pozycja 3a
    - Pozycja 3b

]

---

# Linki

Adresy stron internetowych automatycznie zamieniają się na linki. Można też stworzyć tekst, który będzie prowadził do strony.

__Kod__
```
https://cdv.pl/

[Collegium Da Vinci](https://cdv.pl/)
```

__Wynik__   
   
https://cdv.pl/

[Collegium Da Vinci](https://cdv.pl/)

---

# Regresja

Celem regresji jest poszukanie określonej klasy funkcji, która w możliwie najlepszy sposób charakteryzowałaby zależność pomiędzy zmiennymi.

- Zmienna zależna/objaśniana
- Zmienna niezależna/objaśniająca

- Regresja prosta - jedna zmienna niezależna
- Regresja wieloraka - wiele zmiennych niezależnych

---

# Przykład 

Zbudować model opisujący zależność sprzedaży od liczby klientów w sklepie nr 77.

```{r eval=FALSE, include=FALSE}
model <- lm(sprzedaz ~ liczba_klientow, data=sklep77)
summary(model)

nowa_lk <- data.frame(liczba_klientow=1000)
predict(model, nowa_lk)
```


---

class: center, middle, inverse

# Pytania?